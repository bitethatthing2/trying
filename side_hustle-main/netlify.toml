[build]
  command = "npm run build"
  publish = ".next"

[[plugins]]
  package = "@netlify/plugin-nextjs"

# Headers to ensure proper content types and caching
[[headers]]
  for = "/*"
  [headers.values]
    Cross-Origin-Embedder-Policy = "credentialless"
    Cross-Origin-Opener-Policy = "same-origin"
    Access-Control-Allow-Origin = "*"
    Content-Security-Policy = "default-src 'self' https://*.elfsight.com https://*.googleusercontent.com https://*.instagram.com https://*.cdninstagram.com https://*.gstatic.com https://*.firebase.googleapis.com; img-src 'self' data: https://*.googleusercontent.com https://*.instagram.com https://*.cdninstagram.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://*.elfsight.com https://*.gstatic.com https://*.firebase.googleapis.com; style-src 'self' 'unsafe-inline' https://*.elfsight.com; connect-src 'self' https://*.elfsight.com https://*.googleapis.com https://*.instagram.com https://*.gstatic.com https://*.firebase.googleapis.com;"
    Permissions-Policy = "interest-cohort=()"

[[headers]]
  for = "/only_these/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/only_these/logos/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
    Content-Type = "image/png"

[[headers]]
  for = "/only_these/ios/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
    Content-Type = "image/png"

[[headers]]
  for = "/only_these/android/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
    Content-Type = "image/png"

[[headers]]
  for = "/*.png"
  [headers.values]
    Content-Type = "image/png"
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.ico"
  [headers.values]
    Content-Type = "image/x-icon"

# Redirects for PWA assets
[[redirects]]
  from = "/only_these/*"
  to = "/only_these/:splat"
  status = 200

[[redirects]]
  from = "/only_these/logos/*"
  to = "/only_these/logos/:splat"
  status = 200

[[redirects]]
  from = "/manifest.json"
  to = "/manifest.json"
  status = 200

[[redirects]]
  from = "/firebase-messaging-sw.js"
  to = "/firebase-messaging-sw.js"
  status = 200

# Make sure all static assets are accessible
[[redirects]]
  from = "/static/*"
  to = "/static/:splat"
  status = 200

# Fallback
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[build.environment]
  NODE_VERSION = "18"
  NPM_VERSION = "9"
  NEXT_USE_NETLIFY_EDGE = "true"
  NEXT_PUBLIC_FIREBASE_API_KEY = "AIzaSyB0Nxf3pvW32KBc0D1o2-K6qIeKovhGWfg"
  NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN = "new1-f04b3.firebaseapp.com"
  NEXT_PUBLIC_FIREBASE_PROJECT_ID = "new1-f04b3"
  NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET = "new1-f04b3.firebasestorage.app"
  NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID = "802463638703"
  NEXT_PUBLIC_FIREBASE_APP_ID = "1:802463638703:web:bd0bbdaf3407d784d5205a"
  NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID = "G-3RZEW537LN"
  NEXT_PUBLIC_FIREBASE_FCM_VAPID_KEY = "BPAbU0G8rhAKE7ay5RepQ7N3V_CsdCKvmflQm0FncBbx4CHL0IfmGvdbdYUN90Vjn50JB7T9jzj268KhYJ34ikU"
  NEXT_PUBLIC_SUPABASE_URL = "https://yczowovzpltrwhysayzb.supabase.co"
  NEXT_PUBLIC_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inljem93b3Z6cGx0cndoeXNheXpiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE4MjE5MjUsImV4cCI6MjA1NzM5NzkyNX0.MdU5GnF8uE6JwItCb2mis-2qUyWUKH7sq2cRzqyncwQ"
  # These need to be set in Netlify UI environment variables
  # FIREBASE_PROJECT_ID
  # FIREBASE_CLIENT_EMAIL
  # FIREBASE_PRIVATE_KEY 